\subsection{Shell Sort}

Là một thuật toán sắp xếp dựa trên sắp xếp chèn (Insertion Sort), được 
đặt theo tên của người phát minh, Donald Shell. Thuật toán này cải tiến 
sắp xếp chèn bằng cách cho phép so sánh và hoán đổi các phần tử cách xa 
nhau trước khi thu hẹp khoảng cách lại. Điều này giúp giảm thiểu số lần 
hoán đổi và dịch chuyển các phần tử. Đây là một thuật toán không ổn định, 
phần tử bằng nhau có thể bị đổi chỗ do hoán đổi các nhóm cách xa nhau.

\subsubsection{Ý tưởng}

\begin{enumerate}
    \item Thay vì sắp xếp toàn bộ danh sách một cách tuần tự, Shell Sort 
    chia danh sách thành các danh sách con với khoảng cách giữa các phần 
    tử được xác định bởi một giá trị gọi là khoảng cách (interval).
    \item Thuật toán sử dụng sắp xếp chèn để sắp xếp các phần tử trong 
    từng danh sách con này.
    \item Sau mỗi vòng lặp, khoảng cách được thu nhỏ dần, cuối cùng trở 
    về 1, lúc này danh sách được sắp xếp hoàn chỉnh.
\end{enumerate}

\subsubsection{Mã giả}

\begin{algorithm}[H]
\caption{Shell Sort}
\SetKwFunction{ShellSort}{ShellSort}
\SetKwProg{Fn}{Function}{:}{}
\Fn{\ShellSort{a\KwSty{[]}, n}}{
    // Bước 1: Khởi tạo khoảng cách \\
    $gap \gets n / 2$ \\
    \While{$gap > 0$}{
        // Bước 2: Sắp xếp chèn với khoảng cách gap \\
        \For{$i \gets gap$ \KwTo $n - 1$}{
            $temp \gets a[i]$ \\
            $j \gets i$ \\
            // Dịch chuyển các phần tử lớn hơn temp lên một khoảng cách \\
            \While{$j \geq gap$ \KwSty{and} $a[j - gap] > temp$}{
                $a[j] \gets a[j - gap]$ \\
                $j \gets j - gap$ \\
            }
            // Đặt temp vào đúng vị trí \\
            $a[j] \gets temp$ \\
        }
        // Bước 3: Giảm khoảng cách \\
        $gap \gets gap / 2$ \\
    }
}
\textbf{end function}
\end{algorithm}

\subsubsection{Ví dụ}

Giả sử ta có mảng ban đầu với $n=5$ như sau:
\begin{center}
    \begin{tikzpicture}
        \node[draw, fill=white] at (9, 0) {9};
        \node[draw, fill=white] at (10, 0) {8};
        \node[draw, fill=white] at (11, 0) {3};
        \node[draw, fill=white] at (12, 0) {7};
        \node[draw, fill=white] at (13, 0) {5};
    \end{tikzpicture}
\end{center}

Bắt đầu với $gap = 2$, thực hiện sắp xếp chèn với khoảng cách $gap$ 
cho từng phần tử từ vị trí $gap$ đến hết bên phải mảng.

\begin{center}
    \begin{tikzpicture}
        % Substep 1
        \node[draw, fill=yellow] at (1, -3.5) {9};
        \node[draw, fill=white] at (2, -3.5) {8};
        \node[draw, fill=yellow] at (3, -3.5) {3};
        \node[draw, fill=white] at (4, -3.5) {7};
        \node[draw, fill=white] at (5, -3.5) {5};
        \draw[<-, line width=0.6mm, shorten <=0pt] (3.5, -3) -- (3.5, -2.5);
        \draw[line width=0.6mm] (3.5, -2.5) -- (1.5, -2.5);
        \draw[->, line width=0.6mm, shorten >=0pt] (1.5, -2.5) -- (1.5, -3);
        
        \draw[->, line width=0.6mm] (7, -3.5) -- (8, -3.5);
        
        \node[draw, fill=yellow] at (9, -3.5) {3};
        \node[draw, fill=white] at (10, -3.5) {8};
        \node[draw, fill=yellow] at (11, -3.5) {9};
        \node[draw, fill=white] at (12, -3.5) {7};
        \node[draw, fill=white] at (13, -3.5) {5};
        
        % Substep 2
        \node[draw, fill=white] at (1, -5.5) {3};
        \node[draw, fill=yellow] at (2, -5.5) {8};
        \node[draw, fill=white] at (3, -5.5) {9};
        \node[draw, fill=yellow] at (4, -5.5) {7};
        \node[draw, fill=white] at (5, -5.5) {5};
        \draw[<-, line width=0.6mm, shorten <=0pt] (4.5, -5) -- (4.5, -4.5);
        \draw[line width=0.6mm] (4.5, -4.5) -- (2.5, -4.5);
        \draw[->, line width=0.6mm, shorten >=0pt] (2.5, -4.5) -- (2.5, -5);
        
        \draw[->, line width=0.6mm] (7, -5.5) -- (8, -5.5);
        
        \node[draw, fill=white] at (9, -5.5) {3};
        \node[draw, fill=yellow] at (10, -5.5) {7};
        \node[draw, fill=white] at (11, -5.5) {9};
        \node[draw, fill=yellow] at (12, -5.5) {8};
        \node[draw, fill=white] at (13, -5.5) {5};
        
        % Substep 3
        \node[draw, fill=white] at (1, -7.5) {3};
        \node[draw, fill=white] at (2, -7.5) {7};
        \node[draw, fill=yellow] at (3, -7.5) {9};
        \node[draw, fill=white] at (4, -7.5) {8};
        \node[draw, fill=yellow] at (5, -7.5) {5};
        \draw[<-, line width=0.6mm, shorten <=0pt] (5.5, -7) -- (5.5, -6.5);
        \draw[line width=0.6mm] (5.5, -6.5) -- (3.5, -6.5);
        \draw[->, line width=0.6mm, shorten >=0pt] (3.5, -6.5) -- (3.5, -7);
        
        \draw[->, line width=0.6mm] (7, -7.5) -- (8, -7.5);
        
        \node[draw, fill=white] at (9, -7.5) {3};
        \node[draw, fill=white] at (10, -7.5) {7};
        \node[draw, fill=yellow] at (11, -7.5) {5};
        \node[draw, fill=white] at (12, -7.5) {8};
        \node[draw, fill=yellow] at (13, -7.5) {9};
    \end{tikzpicture}
\end{center}

Thực hiện tương tự với $gap = 1$, ta thu được mảng đã sắp xếp:

\begin{center}
    \begin{tikzpicture}
        \node[draw, fill=blue] at (9, 0) {3};
        \node[draw, fill=blue] at (10, 0) {5};
        \node[draw, fill=blue] at (11, 0) {7};
        \node[draw, fill=blue] at (12, 0) {8};
        \node[draw, fill=blue] at (13, 0) {9};
    \end{tikzpicture}
\end{center}

\subsubsection{Độ phức tạp thuật toán}

\begin{itemize}
    \item Độ phức tạp thời gian
    \begin{itemize}[label=$\circ$]
        \item Trường hợp tốt nhất: $O\left(n\log{n}\right)$, khi dữ liệu 
        gần như đã được sắp xếp hoàn chỉnh. Với mảng gần như đã được sắp 
        xếp hoàn chỉnh, mỗi lần chèn trong các bước của Insertion Sort sẽ 
        tốn rất ít thời gian. Số lần duyệt qua mảng giảm đáng kể nhờ khoảng 
        cách lớn ban đầu.
        \item Trường hợp xấu nhất: $O\left(n^2\right)$, khi mảng đầu vào 
        có thứ tự ngẫu nhiên. Trong trường hợp chuỗi khoảng cách không 
        hiệu quả, các phần tử không được sắp xếp tốt ở các bước đầu, dẫn 
        đến hiệu suất kém ở bước cuối cùng (khi khoảng cách là 1).
        \item Trường hợp trung bình: $O\left(n^{3/2}\right)$, khi mảng đầu 
        vào có thứ tự ngẫu nhiên. Với chuỗi khoảng cách hợp lý, Shell Sort 
        giảm đáng kể số lần hoán đổi so với Insertion Sort, nhưng vẫn phụ 
        thuộc vào thứ tự ban đầu của mảng.
    \end{itemize}
    Lưu ý: Chuỗi khoảng cách là tập hợp tất cả các giá trị mà $gap$ nhận 
    trong quá trình thực hiện thuật toán.
    
    \item Độ phức tạp không gian: $O\left(1\right)$, vì Shell Sort là một 
    thuật toán in-place, nghĩa là nó không sử dụng bất kỳ cấu trúc dữ liệu 
    phụ nào ngoài một số biến tạm thời. Toàn bộ việc sắp xếp được thực hiện 
    trực tiếp trên mảng đầu vào. 
\end{itemize}